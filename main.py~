# main.py
import scraper
import data_packager
import database
import datetime


def main(day=None, month=None, year=None):
    if day is None or month is None or year is None:
        today = datetime.date.today()
        day, month, year = today.day, today.month, today.year

    date_str = f"{day}-{month}-{year}"
    html_downloaded = scraper.download(day, month, year)
    if not html_downloaded:
        print(f"{date_str} not downloaded")
        return

    data_packager.process_and_store_data(date_str)
    scraper.remove()


if __name__ == "__main__":
    database.init_db()
    print("Rozpoczynam pobieranie danych historycznych...")
    for i in range(10):  # Pobierz dane z ostatnich 10 dni
        date_to_fetch = datetime.date.today() - datetime.timedelta(days=i)
        main(day=date_to_fetch.day, month=date_to_fetch.month, year=date_to_fetch.year)

    print("Zako≈Ñczono pobieranie danych.")
